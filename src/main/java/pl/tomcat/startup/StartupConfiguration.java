package pl.tomcat.startup;

import java.util.Timer;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import osmgraphmodel.Program;
import pl.webservice.rest.InsigmaREST;
import test.SimpleTask;

/**
 *
 * @author Micha≈Ç
 */

//Klasa odpowiedzialna za uruchamianie ladowania mapy wektorowej do pamieci programu
public class StartupConfiguration implements ServletContextListener{
  
  private Timer timer = new Timer();
  
  @Override
  public void contextInitialized(ServletContextEvent event) {
    //start
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");

      try {
        Program program = new Program();
        program.loadVectorDataFromFile();
        program.makeIndexForPointSegment();
        
        program.loadTrafficParametersFromDatabase();
        timer.schedule(new TrafficParametersTask(), 0, 60000);   
        
        System.out.println("KONIEC TIMERA");
      } catch (Exception ex) {
        Logger.getLogger(InsigmaREST.class.getName()).log(Level.SEVERE, null, ex);
      }
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
    System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
	
  }
        

    public void contextDestroyed(ServletContextEvent event) {
        //end
        timer.cancel();
        timer.purge();
        
        System.out.println("????????????????????????????????????????");
        System.out.println("????????????????????????????????????????");
        System.out.println("????????????????????????????????????????");
        System.out.println("????????????????????????????????????????");
        System.out.println("????????????????????????????????????????");
        System.out.println("????????????????????????????????????????");
        
    }
}
